
<shared-navbar
    [title]="pageTitle()"
>
</shared-navbar>

<div class="container mx-auto p-4 vh-screen-navbar flex flex-col">    

    <div class="mb-4 border border-surface-200 p-3 rounded-md grid grid-cols-3 gap-2">
        <p-button 
            severity="success" 
            label="Generar" 
            icon="pi pi-plus"
            size="small"
            styleClass="w-full"
            routerLink="/cotizador/generar"
        />
        <p-button 
            severity="info" 
            label="Editar" 
            icon="pi pi-pen-to-square"             
            styleClass="w-full"
            size="small"
            [disabled]="selectedCotizacion === null"
            (onClick)="navigateToEditPage()"
        />
        <p-button 
            severity="danger" 
            label="Eliminar" 
            icon="pi pi-trash"
            size="small"
            styleClass="w-full"
            [disabled]="selectedCotizacion === null"
            (onClick)="confirmationModal($event)"
            [loading]="loading"
        />        
        <!-- @if(false) {
            <p-button 
                severity="info" 
                label="Detalle" 
                icon="pi pi-info-circle"
                size="small"
                styleClass="w-full"
                [disabled]="selectedCotizacion === null"
                (onClick)="changeModalVisibility(true)"
            />            
        } -->
    </div>
    
    @if(!isDeviceMobile()) {
        <div class="grow overflow-y-auto text-sm">
            
            <p-table 
                [value]="cotizaciones" 
                [tableStyle]="{ 'min-width': '30rem' }"
                [loading]="loadingTable"
                
                selectionMode="single"
                [(selection)]="selectedCotizacion" 
                dataKey="no"            
    
                [paginator]="true"
                [rows]="10"
                [rowsPerPageOptions]="[5, 10, 20, 30]"
                [scrollable]="true" 
                [scrollHeight]="'flex'"            
                >
                <ng-template #header>
                    <tr>
                        <th class="px-1 md:px-3" pSortableColumn="fecha" style="width:15%">
                            Fecha <p-sortIcon field="fecha" />
                        </th>
                        <th class="px-1 md:px-3" pSortableColumn="no" style="width:15%">
                            CÃ³digo <p-sortIcon field="no" />
                        </th>
                        <th class="px-1 md:px-3" pSortableColumn="clientName" style="width:40%">
                            Cliente <p-sortIcon field="clientName" />
                        </th>
                        <th pSortableColumn="totalPrice" style="width:15%">
                            Monto <p-sortIcon field="totalPrice" />
                        </th>
                        <th class="px-1 md:px-3" pSortableColumn="status" style="width:15%">
                            Estado <p-sortIcon field="status" />
                        </th>                
                    </tr>
                </ng-template>
                <ng-template #body let-cotizacion >
                    <tr 
                        [pSelectableRow]="cotizacion"
                    >      
                        <td class="px-1 md:px-3" 
                            [ngClass]="{'text-center' : !cotizacion.fecha}">
                            {{ !cotizacion.fecha ? '-' :  (cotizacion.fecha | date:'dd/MM/yyyy') }}
                        </td>              
                        <td class="px-1 md:px-3">
                            <a [routerLink]="['/cotizador/generar/']" [state]="{ cotizacionId: cotizacion!.no}"
                                class="text-blue-500 hover:underline"
                            >
                                {{ cotizacion.no }}
                            </a>
                        </td>              
                        <td class="px-1 md:px-3">{{ (cotizacion.clientName.length === 0 ) ? 'NOTA VENTA' : cotizacion.clientName }}</td>
                        <td>{{ cotizacion.totalPrice | currency:'S/ ' }}</td>
                        <td class="px-1 md:px-3">
                            <p-tag [severity]="getStatusSeverity(cotizacion.status)" [value]="cotizacionStatus[cotizacion.status]" />
                        </td>
                    </tr>
                </ng-template>
    
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="5" class="text-center">No se encontraron datos.</td>
                    </tr>
                </ng-template>
        
            </p-table>
            
        </div>
    }
    @else {
        <div class="grow overflow-y-auto vh-screen-container-products" #productsContainerList>
    
            <p-dataview #dv [value]="cotizaciones" [paginator]="true" [rowsPerPageOptions]="[10, 20, 30]" [rows]="10" (onPage)="scrollTop()">
                <div class="">
                    <ng-template #list let-items>
                        <div class=""  >
                            <div *ngFor="let cotizacion of items; let first = first">
                                <div class="grid grid-cols-12 border-b ease-in duration-100 border-zinc-300 py-2 px-1"
                                    [ngClass]="{'bg-zinc-200': selectedCotizacion?.no === cotizacion.no}"
                                    (click)="selectCotizacion(cotizacion)" >
                                    <div class="col-span-12 flex justify-between text-zinc-500 font-medium text-[14px]">
                                        <div class="flex gap-2">
                                            <a [routerLink]="['/cotizador/generar/']" [state]="{ cotizacionId: cotizacion!.no}"
                                                class="text-blue-500 hover:underline w-[100px]">
                                                {{ cotizacion.no }}
                                            </a>
                                            <p-tag [severity]="getStatusSeverity(cotizacion.status)" [value]="cotizacionStatus[cotizacion.status]" styleClass="px-1 py-0"/>
                                        </div>
                                        <span>
                                            {{cotizacion.fecha | date:'dd/MM/yyyy'}}
                                        </span>
                                    </div>
                                    <div class="col-span-12 grid grid-cols-12 pt-2">
                                        <span class="font-semibold col-span-8 flex w-full items-center ">
                                            {{cotizacion.clientName.trim().length === 0 ? 'NOTA VENTA' : cotizacion.clientName}}
                                        </span>
                                        <span class="col-span-4 text-right flex w-full items-center justify-end">
                                            {{cotizacion.totalPrice | currency:'S/ '}}
                                        </span>
                                    </div>                                        
                                </div>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template #emptymessage  >
                        <div class="vh-screen-container-products p-4">
                            <p class="text-center py-10 px-1">No se encontraron datos.</p>
                        </div>
                    </ng-template>
                </div>
            </p-dataview>
        </div>
    }
    

</div>

<p-confirmdialog />
<p-toast position="top-center" key="listado-toast" />